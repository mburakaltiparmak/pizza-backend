# ============================================================================
# APPLICATION-PROD.PROPERTIES - PRODUCTION ENVIRONMENT
# ============================================================================
# DATABASE CONFIGURATION - PUBLIC SCHEMA (PRODUCTION)
# ============================================================================
# Spring Boot will automatically bind SPRING_DATASOURCE_URL → spring.datasource.url
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://postgres:5432/pizza}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.default_schema=public
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# Connection Pool (HikariCP) - Production settings
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# ============================================================================
# REDIS CONFIGURATION - PROD
# ============================================================================
# Spring Boot will automatically bind SPRING_DATA_REDIS_HOST → spring.data.redis.host
spring.data.redis.host=${SPRING_DATA_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT:6379}
spring.data.redis.password=${SPRING_DATA_REDIS_PASSWORD:}
spring.data.redis.timeout=60000
spring.data.redis.database=0
spring.data.redis.ssl.enabled=${REDIS_SSL_ENABLED:false}

# Redis Cache Configuration
spring.cache.type=redis
spring.cache.redis.time-to-live=3600000
spring.cache.redis.cache-null-values=false
spring.cache.redis.use-key-prefix=true
spring.cache.redis.key-prefix=prod:

# ============================================================================
# JWT CONFIGURATION - PROD (Phase 4.4: Access & Refresh Token Separation)
# ============================================================================
jwt.secret=${JWT_SECRET}

# LEGACY: Kept for backward compatibility (deprecated methods use this)
jwt.expiration=86400000

# PHASE 4.4 NEW: Access Token (short-lived for API authentication)
# Duration: 30 minutes = 1800000ms (recommended for production security)
# Used by: UnifiedTokenProvider.generateAccessToken()
jwt.access-token.expiration=1800000

# PHASE 4.4 NEW: Refresh Token (long-lived, stored in database via RefreshTokenService)
# Duration: 7 days = 604800000ms (balance between security and UX)
# Used by: RefreshTokenServiceImpl
# Note: Can increase to 30 days (2592000000ms) if needed for better UX
jwt.refresh-token.expiration=604800000

# ============================================================================
# CLOUDINARY CONFIGURATION - PROD
# ============================================================================
cloudinary.cloud-name=${CLOUDINARY_CLOUD_NAME}
cloudinary.api-key=${CLOUDINARY_API_KEY}
cloudinary.api-secret=${CLOUDINARY_API_SECRET}

# ============================================================================
# EMAIL CONFIGURATION - PROD
# ============================================================================
spring.mail.host=${MAIL_HOST}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_PASSWORD}
spring.mail.properties.mail.smtp.starttls.enable=true

# Email Async Configuration
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000

# ============================================================================
# CORS CONFIGURATION - PROD (Strict)
# ============================================================================
# Custom property for CorsConfig.java
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000}
spring.mvc.cors.max-age=3600

# ============================================================================
# SUPABASE CONFIGURATION - PROD (Required for JwksService)
# ============================================================================
app.supabase.url=${APP_SUPABASE_URL:}
app.supabase.enabled=${APP_SUPABASE_ENABLED:true}

# ============================================================================
# LOGGING CONFIGURATION - PROD (Minimal)
# ============================================================================
logging.level.root=WARN
logging.level.com.example.pizza=INFO
logging.level.org.springframework.web=WARN
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=WARN

# Log to file
logging.file.name=/var/log/pizza-app/application.log
logging.file.max-size=10MB
logging.file.max-history=30

# Log pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ============================================================================
# ACTUATOR CONFIGURATION - PROD (Limited)
# ============================================================================
management.endpoints.web.exposure.include=health,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.endpoint.metrics.enabled=true
management.endpoint.prometheus.enabled=true

# Security for actuator
management.endpoints.web.base-path=/actuator
management.security.enabled=true

# ============================================================================
# MULTIPART FILE UPLOAD - PROD
# ============================================================================
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=5MB
spring.servlet.multipart.enabled=true

# ============================================================================
# ASYNC CONFIGURATION - PROD
# ============================================================================
spring.task.execution.pool.core-size=10
spring.task.execution.pool.max-size=20
spring.task.execution.pool.queue-capacity=50
spring.task.execution.thread-name-prefix=prod-async-

# ============================================================================
# SERVER CONFIGURATION - PROD
# ============================================================================
server.port=${PORT:8080}
server.error.include-message=never
server.error.include-binding-errors=never
server.error.include-stacktrace=never
server.error.include-exception=false

# Compression
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json

# ============================================================================
# SECURITY HEADERS - PROD
# ============================================================================
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.same-site=strict

# ============================================================================
# PRODUCTION MODE FLAGS
# ============================================================================
app.environment=production
app.dev-mode=false
app.using-test-data=false
app.database.schema=public

# ============================================================================
# RATE LIMITING - PROD (Strict)
# ============================================================================
bucket4j.enabled=true
bucket4j.filters[0].cache-name=rate-limit-buckets-prod
bucket4j.filters[0].url=.*
bucket4j.filters[0].rate-limits[0].bandwidths[0].capacity=100
bucket4j.filters[0].rate-limits[0].bandwidths[0].time=1
bucket4j.filters[0].rate-limits[0].bandwidths[0].unit=minutes

# ============================================================================
# SSL/TLS CONFIGURATION (If needed)
# ============================================================================
# server.ssl.enabled=true
# server.ssl.key-store=${SSL_KEY_STORE}
# server.ssl.key-store-password=${SSL_KEY_STORE_PASSWORD}
# server.ssl.key-store-type=PKCS12